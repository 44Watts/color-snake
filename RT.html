<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rose Talbert Paints — Color Snake</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --rt-navy:#214b86;   /* ROSE TALBERT */
    --rt-light:#8fa9c9;  /* PAINTS + board bg */
    --bg:#fbfcfe;
    --hud-chip:rgba(33,75,134,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:#1a1f2b;
    font-family:'Press Start 2P', system-ui, monospace;
    text-align:center;
    overflow:hidden; /* stop page scrolling with arrow keys */
  }

  header{
    position:sticky; top:0; z-index:10;
    background:#fff; padding:10px 10px 6px; border-bottom:1px solid #ecf0f6;
  }
  .brand{
    display:flex; gap:12px; align-items:baseline; justify-content:center; flex-wrap:wrap;
  }
  .brand .rt-strong{color:var(--rt-navy); font-weight:700; letter-spacing:1px; font-size:24px}
  .brand .rt-soft{color:var(--rt-light); letter-spacing:1px; font-size:24px}

  .hud{
    display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap;
    margin-top:6px;
  }
  .chip{
    display:inline-flex; align-items:center; gap:6px; line-height:1;
    padding:6px 10px; border-radius:9999px; background:var(--hud-chip); color:#1f3254; font-size:12px;
    border:1px solid rgba(33,75,134,.12);
  }

  #colorBanner{
    margin:8px auto 6px; padding:8px 10px; border-radius:10px;
    width:min(760px,92vw); background:#ffffff; color:#0f1830;
    border:1px solid #e8edf5; box-shadow:0 6px 24px rgba(16,35,66,.08);
    opacity:0; transform:translateY(-6px); transition:opacity .25s, transform .25s;
    font-size:12px;
  }
  #colorBanner.show{opacity:1; transform:translateY(0)}

  /* Game board now uses RT light blue */
  #game{
    display:block; margin:8px auto 10px;
    width:min(92vw,720px); height:min(92vw,720px);
    max-width:720px; max-height:720px;
    border-radius:16px; background:var(--rt-light);
    box-shadow:0 2px 3px rgba(9,22,43,.03), 0 14px 32px rgba(9,22,43,.10);
    touch-action:manipulation;
  }

  .controls{margin:0 0 10px}
  .dpad{display:inline-grid; grid-template-columns:repeat(3,52px); gap:6px}
  .dpad button{
    font-family:'Press Start 2P', monospace; font-size:13px;
    padding:10px 0; border:none; border-radius:10px; cursor:pointer;
    background:#f3f6fd; color:#1a2742; box-shadow:0 6px 18px rgba(0,0,0,.12)
  }
  .dpad .blank{visibility:hidden}
</style>
</head>
<body>
  <header>
    <div class="brand" aria-label="Rose Talbert Paints">
      <div class="rt-strong">ROSE TALBERT</div>
      <div class="rt-soft">PAINTS</div>
    </div>
    <div class="hud" aria-label="Scoreboard">
      <div class="chip">Score: <span id="score">0</span></div>
      <div class="chip">High: <span id="high">0</span></div>
    </div>
  </header>

  <div id="colorBanner" role="status" aria-live="polite"></div>

  <canvas id="game" width="600" height="600" aria-label="Snake game board"></canvas>

  <div class="controls" aria-label="On-screen controls">
    <div class="dpad">
      <span class="blank"></span><button id="up" title="Up">↑</button><span class="blank"></span>
      <button id="left" title="Left">←</button><button id="down" title="Down">↓</button><button id="right" title="Right">→</button>
    </div>
  </div>

<script>
(() => {
  const CELL=30, COLS=20, ROWS=20, TICK_MS=95;
  const MAX_LIGHTEN = 0.95; // cap: body never lightens more than +10% L (no white fade)

  const PALETTE = [
	{name:'Bridesmaid',hex:'#9F2C5C'},
	{name:'Chuckles',hex:'#BF413A'},
	{name:'I Love to Boogie',hex:'#FFA917'},
   	{name:'Yolk',hex:'#EFC700'},
	{name:'Arizona Stone',hex:'#00655A'},
	{name:'Frozen Blue',hex:'#354079'},
	{name:'Charybdis',hex:'#16A3CB'},
	{name:'Hideaway',hex:'#654637'},
	{name:'Joyous Song',hex:'#5B365E'},
	{name:'Orange You Happy?',hex:'#FD7F22'}
  ];

  const canvas = document.getElementById('game');
  const c = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highEl  = document.getElementById('high');
  const banner  = document.getElementById('colorBanner');

  let snake, dir, nextDir, food, score, high, loop, overlayAlpha=0, lastTick=Date.now();
  let currentPaint = {name:'Slate', hex:'#60717f'};
  let queuedGrowth = 2;
  let mode='start', shakeTime=0, shakeMag=0;

  const randInt = n => Math.floor(Math.random()*n);
  const pickColor = () => PALETTE[randInt(PALETTE.length)];

  high = Number(localStorage.getItem('rtp_color_snake_high') || 0);
  highEl.textContent = high;

  function reset(){
    snake=[{x:Math.floor(COLS/2), y:Math.floor(ROWS/2)}];
    dir={x:1,y:0}; nextDir={x:1,y:0};
    currentPaint={name:'Slate',hex:'#60717f'};
    queuedGrowth=2; score=0; overlayAlpha=0;
    hideBanner(); food=spawnFood(); updateHUD(); render();
  }
  function spawnFood(){
    let pos; do { pos={x:randInt(COLS), y:randInt(ROWS)}; }
    while (snake.some(s=>s.x===pos.x && s.y===pos.y));
    return {...pos, paint: pickColor()};
  }
  function showBanner(text, color){
    banner.textContent = `NOW PAINTING: ${text.toUpperCase()}`;
    banner.style.boxShadow = `0 6px 24px ${hexToRGBA(color,.22)}`;
    banner.style.borderColor = hexToRGBA(color,.35);
    banner.classList.add('show'); clearTimeout(showBanner._t);
    showBanner._t = setTimeout(()=>banner.classList.remove('show'), 2200);
  }
  function hideBanner(){ banner.classList.remove('show'); clearTimeout(showBanner._t); }
  function updateHUD(){ scoreEl.textContent = score; highEl.textContent = high; }

  /* Draw a rounded cell with a white outline (swatch divider) */
  function drawCell(x,y,fill,radius=6){
    const px=x*CELL, py=y*CELL, w=CELL, h=CELL, r=radius;
    c.beginPath();
    c.moveTo(px+r,py);
    c.arcTo(px+w,py,px+w,py+h,r);
    c.arcTo(px+w,py+h,px,py+h,r);
    c.arcTo(px,py+h,px,py,r);
    c.arcTo(px,py,px+w,py,r);
    c.closePath();
    c.fillStyle=fill; c.fill();
    // white outline to separate squares
    c.lineWidth=2; c.strokeStyle='#ffffff'; c.stroke();
    // subtle highlight
    c.save(); c.globalAlpha=.07; c.fillStyle='#fff';
    c.beginPath();
    c.moveTo(px+r-1,py+2);
    c.arcTo(px+w-2,py+2,px+w-2,py+h/2,r-2);
    c.arcTo(px+w-2,py+h/2,px+2,py+h/2,r-2);
    c.arcTo(px+2,py+h/2,px+2,py+2,r-2);
    c.arcTo(px+2,py+2,px+w-2,py+2,r-2);
    c.closePath(); c.fill(); c.restore();
  }

  function drawSnake(){
    const headHex = currentPaint.hex;
    const {h,s,l} = hexToHSL(headHex);

    // Determine target max lightness (cap at +10% points, also cap to 92% total)
    const maxL = Math.min(0.92, l + MAX_LIGHTEN);

    for (let i=snake.length-1; i>=0; i--){
      const seg = snake[i];
      if (i===0){
        drawCell(seg.x, seg.y, hslToCss(h, s, l), 6);
      } else {
        // interpolate from head L to maxL across the body
        const t = Math.min(1, i / Math.max(1, snake.length-1));
        const li = l + (maxL - l) * t;       // smooth fade but never to white
        const si = s * (1 - 0.05*t);         // tiny desat toward the tail
        drawCell(seg.x, seg.y, hslToCss(h, si, li), 6);
      }
    }
  }

  function drawCan(f){
    const px=f.x*CELL + CELL/2, py=f.y*CELL + CELL/2;
    const w=CELL*0.66, h=CELL*0.78, r=6;
    const x=px-w/2, y=py-h/2;

    c.save();
    c.fillStyle='#cfd6df';
    c.strokeStyle='#92a0b4';
    c.lineWidth=2;
    roundRect(x,y,w,h,r); c.fill(); c.stroke();

    c.fillStyle=f.paint.hex;
    roundRect(x,y-5,w,10,6); c.fill();
    c.strokeStyle='#5f6a7b'; c.stroke();

    c.fillStyle='#2b3240'; roundRect(x+4, y+h*0.36, w-8, h*0.2, 4); c.fill();
    c.fillStyle=f.paint.hex; roundRect(x+6, y+h*0.38, 18, h*0.16, 3); c.fill();
    c.restore();
  }
  function roundRect(x,y,w,h,r){
    c.beginPath();
    c.moveTo(x+r,y);
    c.arcTo(x+w,y,x+w,y+h,r);
    c.arcTo(x+w,y+h,x,y+h,r);
    c.arcTo(x,y+h,x,y,r);
    c.arcTo(x,y,x+w,y,r);
    c.closePath();
  }

  /* === NEW: subtle grid lines on the board === */
  function drawGrid(){
    c.save();
    c.lineWidth = 1;
    c.strokeStyle = 'rgba(255,255,255,.35)'; // soft white grid
    // verticals
    for (let x=1; x<COLS; x++){
      const px = Math.floor(x*CELL)+0.5;
      c.beginPath(); c.moveTo(px, 0); c.lineTo(px, ROWS*CELL); c.stroke();
    }
    // horizontals
    for (let y=1; y<ROWS; y++){
      const py = Math.floor(y*CELL)+0.5;
      c.beginPath(); c.moveTo(0, py); c.lineTo(COLS*CELL, py); c.stroke();
    }
    c.restore();
  }

  /* Simple overlays */
  function renderStartOverlay(){
    c.save();
    c.fillStyle='rgba(255,255,255,.90)';
    c.fillRect(0,0,canvas.width,canvas.height);
    c.fillStyle='#1d2c4a';
    c.textAlign='center';
    c.font='20px "Press Start 2P", monospace';
    c.fillText('Color Snake', canvas.width/2, canvas.height/2 - 100);
    c.font='12px "Press Start 2P", monospace';
    const lines=[
      'Eat PAINT CANS to grow.',
      'Head = true color • Body = lighter swatch (max +10%).',
      'Arrows / WASD to move. Avoid walls & yourself.',
      'Press any key or tap to begin'
    ];
    let y=canvas.height/2 - 50;
    for(const L of lines){ c.fillText(L, canvas.width/2, y); y+=26; }
    c.font='14px "Press Start 2P", monospace';
    c.fillText('START', canvas.width/2, canvas.height/2 + 80);
    c.restore();
  }
  function renderGameOverOverlay(){
    if (overlayAlpha<=0) return;
    c.save();
    c.globalAlpha=overlayAlpha;
    c.fillStyle='rgba(255,255,255,.96)';
    c.fillRect(0,0,canvas.width,canvas.height);
    c.globalAlpha=1; c.fillStyle='#1d2c4a';
    c.textAlign='center';
    c.font='20px "Press Start 2P", monospace';
    c.fillText('Game Over', canvas.width/2, canvas.height/2 - 8);
    c.font='12px "Press Start 2P", monospace';
    c.fillText('Press any key or tap to play again', canvas.width/2, canvas.height/2 + 26);
    c.restore();
  }

  function render(){
    c.clearRect(0,0,canvas.width,canvas.height);
    drawGrid();              // <-- ADDED: grid behind everything
    drawCan(food);
    drawSnake();
    if (mode==='start') renderStartOverlay();
    if (mode==='gameover') renderGameOverOverlay();
  }

  function step(){
    const now=Date.now(), dt=now-lastTick; lastTick=now;
    if (shakeTime>0){ shakeTime-=dt; if (shakeTime<0) shakeTime=0; shakeMag*=0.9; }
    if (mode!=='play'){ render(); return; }

    dir=nextDir;
    const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
    // end game on wall hit
    if (head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS){ return gameOver(); }
    // end game on self-collision
    if (snake.some(s=>s.x===head.x && s.y===head.y)) return gameOver();

    snake.unshift(head);
    if (queuedGrowth>0) queuedGrowth--; else snake.pop();

    if (head.x===food.x && head.y===food.y){
      score++; queuedGrowth+=1;
      currentPaint=food.paint;
      showBanner(`${currentPaint.name}`, currentPaint.hex);
      if (score>high){ high=score; localStorage.setItem('rtp_color_snake_high', String(high)); }
      food=spawnFood(); updateHUD();
    }

    render();
  }

  /* === NEW: concrete game over handler === */
  function gameOver(){
    mode='gameover';
    clearInterval(loop);
    overlayAlpha = 0;
    const fade = () => {
      overlayAlpha = Math.min(1, overlayAlpha + 0.08);
      render();
      if (overlayAlpha < 1) requestAnimationFrame(fade);
    };
    fade();
  }

  /* Controls */
  function setDir(x,y){ if (snake.length>1 && x===-dir.x && y===-dir.y) return; nextDir={x,y}; }
  window.addEventListener('keydown', (e)=>{
    const k=e.key.toLowerCase();
    const scrollKeys=['arrowup','arrowdown','arrowleft','arrowright',' '];
    if (scrollKeys.includes(k)||k==='pageup'||k==='pagedown') e.preventDefault();
    if (mode!=='play') start();

    if (k==='arrowup'||k==='w') setDir(0,-1);
    else if (k==='arrowdown'||k==='s') setDir(0,1);
    else if (k==='arrowleft'||k==='a') setDir(-1,0);
    else if (k==='arrowright'||k==='d') setDir(1,0);
  }, {passive:false});
  document.getElementById('up').onclick   = ()=>{ if(mode!=='play') start(); setDir(0,-1); };
  document.getElementById('down').onclick = ()=>{ if(mode!=='play') start(); setDir(0,1);  };
  document.getElementById('left').onclick = ()=>{ if(mode!=='play') start(); setDir(-1,0); };
  document.getElementById('right').onclick= ()=>{ if(mode!=='play') start(); setDir(1,0);  };
  canvas.addEventListener('pointerdown', ()=>{ if(mode!=='play') start(); }, {passive:true});

  function start(){
    reset(); lastTick=Date.now(); mode='play';
    clearInterval(loop); loop=setInterval(step, TICK_MS);
  }

  /* Color utils */
  function hexToRGBA(hex,a=1){ const {r,g,b}=hexToRGB(hex); return `rgba(${r},${g},${b},${a})`; }
  function hexToRGB(hex){
    const h=hex.replace('#','');
    const b=h.length===3? h.split('').map(ch=>parseInt(ch+ch,16))
                        : [parseInt(h.substring(0,2),16),parseInt(h.substring(2,4),16),parseInt(h.substring(4,6),16)];
    return {r:b[0],g:b[1],b:b[2]};
  }
  function hexToHSL(hex){
    let {r,g,b}=hexToRGB(hex); r/=255; g/=255; b/=255;
    const max=Math.max(r,g,b), min=Math.min(r,g,b);
    let h,s,l=(max+min)/2;
    if(max===min){ h=s=0; }
    else{
      const d=max-min; s=l>0.5 ? d/(2-max-min) : d/(max+min);
      switch(max){ case r:h=(g-b)/d+(g<b?6:0); break; case g:h=(b-r)/d+2; break; case b:h=(r-g)/d+4; break; }
      h/=6;
    }
    return {h,s,l};
  }
  function hslToCss(h,s,l){ return `hsl(${Math.round(h*360)} ${Math.round(s*100)}% ${Math.round(l*100)}%)`; }

  reset(); mode='start'; render();
})();
</script>
</body>
</html>
